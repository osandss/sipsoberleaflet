<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />

  <!-- Disable caching so updates always load fresh -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>Zero-Proof Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA manifest + icons -->
  <link rel="manifest" href="/sipsoberleaflet/manifest.json">
  <meta name="theme-color" content="#202329">
  <link rel="apple-touch-icon" href="/sipsoberleaflet/icons/icon-192.png">
  <link rel="icon" href="/sipsoberleaflet/icons/icon-192.png">

  <!-- Leaflet CSS (latest CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin="anonymous"
  />

  <style>
    /* =========================
       APP-ONLY MAP LAYOUT
       ========================= */

   /* Higher-end, crisper, still moody (applied at pane level) */
.leaflet-tile-pane {
  position: relative;
  filter: brightness(1.03) contrast(1.12) saturate(0.90);
}

/* ‚úÖ NAVY BRAND TINT (premium mood) */
.leaflet-tile-pane::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;

  background: rgba(32, 34, 57, 0.07);
  mix-blend-mode: multiply;

  z-index: 200; /* üëà ensures tint sits above tiles */
}

/* Container must also be positioned for vignette */
.leaflet-container {
  position: relative;
  overflow: hidden;
}

/* ‚úÖ Subtle vignette depth (native / premium feel) */
.leaflet-container::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;

  /* subtle premium depth (less ‚Äúfoggy‚Äù than before) */
  background: radial-gradient(
    circle at 50% 25%,
    rgba(255, 255, 255, 0.00) 40%,
    rgba(32, 34, 57, 0.06) 100%
  );

  opacity: 1;
  z-index: 300; /* above tint, below UI */
}

    :root {
    /* mobile panel heights (used for dynamic map resizing) */
    --panel-collapsed: 18vh;
    --panel-expanded: 38vh;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      overscroll-behavior: none;

      /* Cleaner, more modern iOS font stack */
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
        sans-serif;

      /* Softer, professional text color */
      background: #ffffff;
      color: #1c1c1e;

      /* Makes text look smoother on iPhone */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;

      line-height: 1.45;
      font-size: 12px; /* smaller base type */
    }

    /* --- Top filters bar: floating pill --- */
    #filters {
      position: fixed;
      top: 10px;
      left: 20px;
      right: 12px;
      z-index: 3100;

      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;

      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 999px; /* pill shape */
      border: 1px solid #e2e4ec;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.22);

      backdrop-filter: none;
    }

    /* --- Top bar search (after Go) --- */
    .ss-searchTop{
    display: flex;
    align-items: center;
    gap: 8px;
    height: 26px;
    padding: 0 10px;

    background: #f2f2f7;
    border: 1px solid #ccc;
    border-radius: 999px;

    font-size: 12px;
    width: 160px;
    min-width: 160px;
    max-width: 160px;
    flex: 0 0 160px;
    overflow: hidden;
  }

    .ss-searchIcon{
      font-size: 11px;
      opacity: 0.6;
    }

    #searchTopInput{
      border: 0;
      outline: none;
      background: transparent;
      width: 100%;
      font-size: 16px;
      min-width: 0;
      line-height: 1;
      
      transform: scale(0.82);          /* makes it LOOK smaller */
      transform-origin: left center;   /* keep it aligned */
    }

    #searchTopInput::-webkit-search-cancel-button{
      -webkit-appearance: none;
    }
    
    #searchTopClear{
      border: 0;
      background: transparent;
      font-size: 16px;
      line-height: 1;
      opacity: 0.6;
      cursor: pointer;
      padding: 0;
    }

    /* =========================
   TOP SEARCH TOGGLE
   ========================= */

  #searchToggle{
    border: 1px solid #ccc;
    background: #f2f2f7;
    border-radius: 999px;
    padding: 6px 10px;
    font-size: 16px;
    cursor: pointer;
    color: #2f3b69;
  }

  /* collapsible row */
  #searchTopRow{
    display: none;
    width: 100%;
    margin-top: 4px;

    padding-left: 6px; /* aligns search bar under pills */
  }

  #searchTopRow.is-open{
    display: block;
  }

    .dropdown > button {
      background: #f2f2f7;
      border: 1px solid #ccc;
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      color: #2f3b69;
    }

    /* =========================
   Dropdown menus: show ~4 items + scroll
   ========================= */

.dropdown .menu {
  max-height: 160px;          
  overflow-y: auto;
  overflow-x: hidden;

  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}
    
    #goBtn {
      background: #202329;
      color: white;
      border: 0;
      border-radius: 10px;
      padding: 8px 14px;
      font-weight: 600;
      cursor: pointer;
      font-size: 12px;
    }

    /* Main map area ‚Äì fills behind filters and above bottom panel */
    #map {
      position: absolute;
      top: 0; /* ‚úÖ map goes all the way to the top; filters float above */
      left: 0;
      right: 0;
      bottom: 0;
      height: auto;
      z-index: 1;
    }

    /* --- Dropdown menus (hide/show) --- */
    .dropdown {
      position: relative;
    }

    .dropdown .menu {
      display: none;
      position: absolute;
      top: 120%;
      left: 0;

      background: #ffffff;
      border: 1px solid #e2e4ec;
      border-radius: 16px;
      padding: 10px 12px;
      width: 200px;
      z-index: 3000;

      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.16);
    }

    .dropdown.open .menu {
      display: block;
    }

    .dropdown .row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 3px 0;
      margin: 0;
      font-size: 12px;
      color: #1c1c1e;
    }

   
    /* --- Bottom results panel floats above the map --- */
#bottom-panel {
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: 0;

  /* collapsed by default (peek) */
  height: var(--panel-collapsed);

  background: rgba(255, 255, 255, 0.72);
  backdrop-filter: blur(12px); /* iOS glass effect */
  -webkit-backdrop-filter: blur(12px);
  border-radius: 22px 22px 0 0;
  box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.10);

  padding: 10px 18px calc(14px + env(safe-area-inset-bottom));
  z-index: 2001;

  /* animation + behavior */
  transition: height 220ms ease;
  overflow-y: hidden; /* prevent scroll when collapsed */
}

/* expanded state */
#bottom-panel.expanded {
  height: var(--panel-expanded);
  overflow-y: auto;
}

/* results list inside the panel */
#results {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px;
}


/* --- Panel toggle handle (tap to expand/collapse) --- */
#panel-toggle {
  width: 100%;
  border: 0;
  background: transparent;
  padding: 6px 0 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

#panel-toggle .handle {
  width: 44px;
  height: 5px;
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.18);
}

#panel-toggle .label {
  font-size: 12px;
  font-weight: 600;
  opacity: 0.6;
}
    
    /* --- Results count (under active filters) --- */
    #results-count {
      font-size: 13px;
      font-weight: 500;
      color: #5f6368;
      margin: 6px 10px 6px;   /* left aligns with #results padding */
      letter-spacing: 0.01em;
    }


    /* --- Bottom panel card styling --- */
    .card {
      padding: 10px 10px;
      border-bottom: 1px solid #eee;
      margin-bottom: 0;
      font-size: 12px;
      color: #333;
      line-height: 1.25;
    }

    .card:last-child {
      border-bottom: none;
    }

    /* Venue name */
    .card-name {
      display: block;
      font-size: 14px;
      font-weight: 600;
      margin: 0;
      line-height: 1.15;
      color: #111;
      cursor: pointer;
    }

    .card-name:hover {
      text-decoration: underline;
    }

    .card .meta{
      margin: 2px 0;
      line-height: 1.25;
    }

    #bottom-panel .card p {
      margin: 0;
      line-height: 1.32;
    }

    #bottom-panel .card a {
      display: inline-block;
      margin: 2px 0 4px;
      font-size: 12px;
      font-weight: 500;
      color: #2f3b69;
      text-decoration: underline;
    }

    /* Move Leaflet zoom controls to bottom-right */
    .leaflet-control-zoom {
      bottom: 20px;
      right: 20px;
      left: auto !important;
      top: auto !important;
    }

    .leaflet-top.leaflet-left {
      top: auto !important;
      left: auto !important;
      right: 16px !important;
      bottom: 24px !important;
      z-index: 3200 !important; /* above filters */
    }

    /* ============================
       ACTIVE FILTERS ABOVE RESULTS
       ============================ */

    .active-filters {
      display: none; /* JS switches to flex when filters are active */
      flex-wrap: wrap;
      gap: 6px;
      margin: 0 0 10px;
      padding: 4px 4px 6px;
      position: sticky; /* stays visible while panel scrolls */
      top: 0;
      z-index: 2;
      background: transparent;
    }

    .filter-pill {
      display: inline-flex;
      align-items: center;
      background: #f2f2f2;
      border-radius: 14px;
      padding: 4px 10px;
      font-size: 13px;
      color: #333;
    }

    .filter-pill-x {
  margin-left: 6px;
  font-weight: 600;
  cursor: pointer;
}


/* Small tweak for phones only (optional) */
@media (max-width: 720px) {
  #filters {
    top: 10px;
  }
}
    
/* =========================
   EMBED MODE (iOS app)
   Hide web top controls when ?embed=1
   ========================= */
body.ss-embed #filters {
  display: none !important;
}
    
/* Favorite star */
.fav-btn{
  background: none;
  border: 0;
  padding: 6px;
  cursor: pointer;
  font-size: 22px;
  line-height: 1;
  color: #b9b9b9;
}

.fav-btn.is-fav{
  color: #202239;
}

    .card-top{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 4px;
}

    
/* =========================
   MAP POPUP (Leaflet)
   ========================= */

.leaflet-popup-content-wrapper {
  border-radius: 18px !important;
  box-shadow: 0 16px 40px rgba(0,0,0,0.18) !important;
  padding: 0 !important;
}

.leaflet-popup-content {
  margin: 0 !important;
  width: auto !important;
  max-width: none !important;
}

/* Simple popup (structured, map-first) */
.ss-popup--simple {
  padding: 12px;
  min-width: 240px;
  max-width: 300px;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  color: #1c1c1e;
}

/* Top row: thumb + text */
.ss-popup-top{
  display: flex;
  gap: 12px;
  align-items: flex-start;
}

/* Text column */
.ss-popup-text{
  flex: 1;
  min-width: 0;
}

/* Thumbnail */
.ss-popup-img-wrap{
  margin: 0;
  flex: 0 0 104px;
  display: block;
}

.ss-popup-img{
  width: 104px;
  height: 78px;
  max-height: none;
  object-fit: cover;
  border-radius: 12px;
  display: block;
}

/* Title */
.ss-popup--simple .ss-popup-title {
  font-size: 13px;
  font-weight: 700;
  line-height: 1.2;
  margin: 0 0 4px;
}

/* Neighborhood */
.ss-popup--simple .ss-popup-tags {
  font-size: 11px;
  color: rgba(28, 28, 30, 0.55);
  line-height: 1.2;
  margin: 0 0 6px;
}

/* Address */
.ss-popup--simple .ss-popup-meta {
  font-size: 11px;
  color: rgba(28, 28, 30, 0.65);
  line-height: 1.25;
  margin: 0 0 8px;
}

/* Action pills (Option A: smaller, inline, not stacked) */
.ss-popup--simple .ss-popup-actions{
  display: flex;
  gap: 8px;
  flex-wrap: nowrap;       /* keep on one row */
  align-items: center;
  margin-top: 6px;
}

.ss-popup--simple .ss-pill{
  display: inline-flex;
  align-items: center;
  justify-content: center;

  font-size: 11px;
  font-weight: 600;
  line-height: 1;

  padding: 5px 9px;
  border-radius: 999px;

  color: #1c1c1e;
  text-decoration: none;

  background: rgba(28, 28, 30, 0.06);
  border: 1px solid rgba(28, 28, 30, 0.08);

  white-space: nowrap;
  -webkit-tap-highlight-color: transparent;

  transition: background 0.15s ease, transform 0.15s ease;
}

.ss-popup--simple .ss-pill.secondary{
  background: rgba(28, 28, 30, 0.03);
}

.ss-popup--simple .ss-pill:active{
  background: rgba(28, 28, 30, 0.12);
  transform: scale(0.97);
}

/* Smaller, cleaner close "x" */
.leaflet-container a.leaflet-popup-close-button {
  width: 26px !important;
  height: 26px !important;
  font-size: 18px !important;
  line-height: 26px !important;
  color: rgba(28, 28, 30, 0.45) !important;
  right: 6px !important;
  top: 6px !important;
}

/* =========================
   SIP SOBER ‚Äî MAP ONBOARDING BANNER
   ========================= */

.ss-onboard {
  position: fixed;
  left: 12px;
  right: 12px;
  top: 140px; /* keep where it is now */
  z-index: 5000;

  opacity: 0;
  transform: translateY(8px);
  transition: opacity 220ms ease, transform 220ms ease;

  pointer-events: none;
}

.ss-onboard.is-visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.ss-onboard[hidden] {
  display: none !important;
}

.ss-onboard__content {
  pointer-events: auto;
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(32, 34, 57, 0.12);
  border-radius: 18px;
  padding: 12px 14px;
  box-shadow: 0 10px 26px rgba(0,0,0,0.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
}

.ss-onboard__title {
  font-size: 14px;
  font-weight: 800;
  color: #202239;
  margin-bottom: 4px;
}

.ss-onboard__text {
  font-size: 13px;
  line-height: 1.3;
  color: rgba(0,0,0,0.65);
  margin-bottom: 10px;
}

.ss-onboard__actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.ss-onboard__btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 34px;
  padding: 0 12px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 700;
  text-decoration: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

.ss-onboard__btn--primary {
  border: 0;
  color: #fff;
  background: #202239;
}

.ss-onboard__btn--ghost {
  border: 1px solid rgba(32, 34, 57, 0.18);
  color: #202239;
  background: rgba(255,255,255,0.65);
}
    
</style>


  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W6LRN7EDH7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "G-W6LRN7EDH7", {
      send_page_view: true,
    });
  </script>
</head>

<body>

<!-- ===== Sip Sober: one-time onboarding banner ===== -->
<div id="ss-onboard" class="ss-onboard" role="status" aria-live="polite" hidden>
  <div class="ss-onboard__content">
    <div class="ss-onboard__title">Explore &amp; save</div>
    <div class="ss-onboard__text">
      Filter by <b>brand</b> or <b>neighborhood</b>, then tap <b>‚òÖ</b> to save favorites.
    </div>

    <div class="ss-onboard__actions">
      <button id="ss-onboard-ok" class="ss-onboard__btn ss-onboard__btn--primary" type="button">
        Got it
      </button>

    </div>
  </div>
</div>

  
 <!-- TOP CONTROLS (filters + Go) -->
<div id="filters" class="topbar filterbar">

  <div class="dropdown" id="brandDD">
    <button type="button" aria-expanded="false">Brands ‚ñæ</button>
    <div class="menu" role="menu">

      <div class="row">
        <input id="brand-seedlip" type="checkbox" value="Seedlip" />
        <label for="brand-seedlip">Seedlip</label>
      </div>

      <div class="row">
        <input id="brand-ritual" type="checkbox" value="Ritual Zero Proof" />
        <label for="brand-ritual">Ritual Zero Proof</label>
      </div>

      <div class="row">
        <input id="brand-lyres" type="checkbox" value="Lyre's" />
        <label for="brand-lyres">Lyre's</label>
      </div>

      <div class="row">
        <input id="brand-agrestis" type="checkbox" value="St. Agrestis" />
        <label for="brand-agrestis">St. Agrestis</label>
      </div>

      <div class="row">
        <input id="brand-aplos" type="checkbox" value="Apl√≥s" />
        <label for="brand-aplos">Apl√≥s</label>
      </div>

      <div class="row">
        <input id="brand-pathfinder" type="checkbox" value="Pathfinder" />
        <label for="brand-pathfinder">Pathfinder</label>
      </div>

      <div class="row">
        <input id="brand-curious" type="checkbox" value="Curious Elixirs" />
        <label for="brand-curious">Curious Elixirs</label>
      </div>

      <div class="row">
        <input id="brand-goodtime" type="checkbox" value="Good Time Brewing" />
        <label for="brand-goodtime">Good Time Brewing</label>
      </div>

      <div class="row">
        <input id="brand-ghia" type="checkbox" value="Ghia" />
        <label for="brand-ghia">Ghia</label>
      </div>

      <div class="row">
        <input id="brand-pentire" type="checkbox" value="Pentire" />
        <label for="brand-pentire">Pentire</label>
      </div>

      <div class="row">
        <input id="brand-athletic" type="checkbox" value="Athletic Brewing Co." />
        <label for="brand-athletic">Athletic Brewing Co.</label>
      </div>

    </div>
  </div>

  <div class="dropdown" id="neighborhoodDD">
    <button type="button" aria-expanded="false">Neighborhoods ‚ñæ</button>
    <div class="menu" role="menu">

      <div class="row">
        <input id="n-ues" type="checkbox" value="Upper East Side" />
        <label for="n-ues">Upper East Side</label>
      </div>

      <div class="row">
        <input id="n-midtown" type="checkbox" value="Midtown" />
        <label for="n-midtown">Midtown</label>
      </div>

      <div class="row">
        <input id="n-gramercy" type="checkbox" value="Gramercy" />
        <label for="n-gramercy">Gramercy</label>
      </div>

      <div class="row">
        <input id="n-chelsea" type="checkbox" value="Chelsea" />
        <label for="n-chelsea">Chelsea</label>
      </div>

      <div class="row">
        <input id="n-uws" type="checkbox" value="Upper West Side" />
        <label for="n-uws">Upper West Side</label>
      </div>

      <div class="row">
        <input id="n-fidi" type="checkbox" value="FiDi" />
        <label for="n-fidi">FiDi</label>
      </div>

      <div class="row">
        <input id="n-flatiron" type="checkbox" value="Flatiron" />
        <label for="n-flatiron">Flatiron</label>
      </div>

      <div class="row">
        <input id="n-west-village" type="checkbox" value="West Village" />
        <label for="n-west-village">West Village</label>
      </div>
      
      <div class="row">
        <input id="n-tribeca" type="checkbox" value="Tribeca" />
        <label for="n-tribeca">Tribeca</label>
      </div>

      <div class="row">
        <input id="n-soho" type="checkbox" value="SoHo" />
        <label for="n-soho">SoHo</label>
      </div>

      <div class="row">
        <input id="n-east-village" type="checkbox" value="East Village" />
        <label for="n-east-village">East Village</label>
      </div>

    </div>
  </div>

  <button id="goBtn" type="button">Go</button>

  <button
    id="searchToggle"
    type="button"
    aria-label="Search"
    aria-expanded="false"
  >
    üîç
  </button>
  
  <!-- üîç Search (TOP BAR) -->
  <div id="searchTopRow">
    <div class="ss-searchTop">
      <span class="ss-searchIcon" aria-hidden="true">üîç</span>
      <input
        id="searchTopInput"
        type="search"
        placeholder="Search a venue‚Ä¶"
        autocomplete="off"
      />
      <button
        id="searchTopClear"
        type="button"
        aria-label="Clear search"
      >√ó</button>
    </div>
  </div>

</div>

  <!-- Fullscreen Map -->
  <div id="map"></div>

  <!-- Sliding Bottom Results Panel -->
  <div id="bottom-panel">

    <!-- Panel toggle handle -->
    <button id="panel-toggle" type="button" aria-expanded="false">
      <span class="handle" aria-hidden="true"></span>
      <span class="label">Show</span>
    </button>

    <div id="active-filters" class="active-filters"></div>
    <div id="results-count" class="results-count"></div>
    <div id="results"></div>

  </div>

  <!-- Leaflet JS (latest CDN) -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="anonymous"
  ></script>

  <script>
    /* =========================
       A) DATA
       ========================= */
    const locations = [
      { id: "bemelmans", name: "Bemelman's Bar", address: "35 E 76th St, NY", lat: 40.774, lng: -73.9636, website: "https://www.rosewoodhotels.com", brand: "Ritual Zero Proof", neighborhood: "Upper East Side", imageUrl: "venue-images/bemelmans.jpeg" },
      { id: "bar-avant", name: "Bar Avant (Olly Olly Market)", address: "601 W 26th St, NY", lat: 40.7498, lng: -74.0075, website: "https://ollyollymarket.com", brand: "Seedlip, St. Agrestis", neighborhood: "Chelsea", imageUrl: "venue-images/baravant.jpeg" },
      { id: "fumo", name: "Fumo", address: "198 8th Ave, NY", lat: 40.7448, lng: -73.9809, website: "https://fumonyc.com", brand: "Seedlip, Athletic Brewing Co.", neighborhood: "Chelsea", imageUrl: "venue-images/fumochelsea.jpeg" },
      { id: "miriam", name: "Miriam", address: "300 Amsterdam Ave, NY", lat: 40.7809, lng: -73.9797, website: "https://miriamrestaurant.com", brand: "Seedlip, Lyre's, Athletic Brewing Co.", neighborhood: "Upper West Side", imageUrl: "venue-images/miriamuws.jpeg" },
      { id: "sarabeths", name: "Sarabeth's", address: "423 Amsterdam Ave, NY", lat: 40.786, lng: -73.977, website: "https://sarabethsrestaurants.com", brand: "Lyre's", neighborhood: "Upper West Side" },
      { id: "bondurants", name: "Bondurants", address: "303 E 85th St, NY", lat: 40.777, lng: -73.9518, website: "https://bondurantsnyc.com", brand: "Seedlip, Lyre's, Athletic Brewing Co.", neighborhood: "Upper East Side", imageUrl: "venue-images/bondurants.jpeg" },
      { id: "sfoglia", name: "Sfoglia", address: "1402 Lexington Ave, NY", lat: 40.7835, lng: -73.9529, website: "https://sfogliarestaurant.com", brand: "Lyre's, Ritual Zero Proof, St. Agrestis, Good Time Brewing", neighborhood: "Upper East Side", imageUrl: "venue-images/sfoglia.jpeg" },
      { id: "blasket", name: "The Blasket", address: "1085 2nd Ave, NY", lat: 40.7579, lng: -73.9635, website: "https://theblasketnyc.com", brand: "Lyre's, Athletic Brewing Co.", neighborhood: "Midtown", imageUrl: "venue-images/blasket.jpeg" },
      { id: "rosemarysmid", name: "Rosemary's Midtown", address: "825 3rd Ave, NY", lat: 40.7559, lng: -73.9701, website: "https://rosemarysnyc.com", brand: "Lyre's, Ghia, Athletic Brewing Co.", neighborhood: "Midtown", imageUrl: "venue-images/rosemarysmid.jpeg" },
      { id: "hutong", name: "Hutong NYC", address: "731 Lexington Ave, NY", lat: 40.761812, lng: -73.968178, website: "https://hutong-nyc.com", brand: "Athletic Brewing Co., Pathfinder", neighborhood: "Midtown", imageUrl: "venue-images/hutongmid.jpeg" },
      { id: "penrose", name: "The Penrose", address: "1590 2nd Ave, NY", lat: 40.7763, lng: -73.9498, website: "https://penrosebar.com", brand: "Seedlip, Lyre's", neighborhood: "Upper East Side", imageUrl: "venue-images/penrose.jpeg" },
      { id: "orsay", name: "Orsay", address: "1057 Lexington Ave, NY", lat: 40.7731, lng: -73.9599, website: "https://orsayrestaurant.com", brand: "Seedlip", neighborhood: "Upper East Side", imageUrl: "venue-images/orsay.jpeg" },
      { id: "boqueria", name: "Boqueria", address: "1460 2nd Ave, NY", lat: 40.7728, lng: -73.953, website: "https://boqueriarestaurant.com", brand: "Ritual Zero Proof, Seedlip, Athletic Brewing Co.", neighborhood: "Upper East Side", imageUrl: "venue-images/boqueria.jpeg" },
      { id: "cravefishbar", name: "Crave Fishbar", address: "945 2nd Ave, NY", lat: 40.7544, lng: -73.9685, website: "https://cravefishbar.com", brand: "Seedlip", neighborhood: "Midtown" },
      { id: "uva", name: "UVA", address: "1486 2nd Ave, NY", lat: 40.7726, lng: -73.9541, website: "https://uvanyc.com", brand: "Lyre's, Athletic Brewing Co.", neighborhood: "Upper East Side", imageUrl: "venue-images/uva.jpeg" },
      { id: "sefton", name: "Sefton", address: "510 E 117th St, NY", lat: 40.7969, lng: -73.9304, website: "https://seftonnyc.com", brand: "Ritual Zero Proof", neighborhood: "Upper East Side", imageUrl: "venue-images/sefton.jpeg" },
      { id: "hawksmoor", name: "Hawksmoor NYC", address: "109 E 22nd St, NY", lat: 40.7394, lng: -73.9861, website: "https://thehawksmoor.com/us/?pl=null&utm_source=google&utm_medium=organic&utm_campaign=gbp", brand: "Seedlip, Good Time Brewing, Pathfinder", neighborhood: "Gramercy", imageUrl: "venue-images/hawksmoor.jpeg" },
      { id: "monkeybar", name: "Monkey Bar", address: "60 E 54th St, NY", lat: 40.7598, lng: -73.9732, website: "https://www.nycmonkeybar.com", brand: "Ritual Zero Proof, St. Agrestis, Athletic Brewing Co.", neighborhood: "Midtown", imageUrl: "venue-images/monkeybar.jpeg" },
      { id: "gramtav", name: "Gramercy Tavern", address: "42 E 20th St, NY", lat: 40.7386, lng: -73.9882, website: "https://www.gramercytavern.com", brand: "Lyre's, St. Agrestis", neighborhood: "Gramercy", imageUrl: "venue-images/gramercytavern.jpeg" },
      { id: "junction", name: "The Junction", address: "329 Lexington Ave, NY", lat: 40.747, lng: -73.976, website: "https://www.thejunctionnyc.com", brand: "Lyre's, Seedlip, Athletic Brewing Co.", neighborhood: "Midtown", imageUrl: "venue-images/junction.jpeg" },
      { id: "brokenshaker", name: "Broken Shaker", address: "23 Lexington Ave, NY", lat: 40.7395, lng: -73.9845, website: "https://www.brokenshaker.com", brand: "Seedlip, Ritual Zero Proof", neighborhood: "Midtown", imageUrl: "venue-images/brokenshaker.jpeg" },
      { id: "wildflower", name: "Wildflower", address: "505 W 23 St A, NY", lat: 40.744, lng: -73.9988, website: "https://www.wildflowernyc.com", brand: "Seedlip, St. Agrestis, Athletic Brewing Co.", neighborhood: "Chelsea", imageUrl: "venue-images/wildflower.jpeg" },
      { id: "campbell", name: "The Campbell", address: "15 Vanderbilt Ave, NY", lat: 40.7525, lng: -73.9778, website: "https://www.thecampbellnyc.com", brand: "St. Agrestis, Lyre's", neighborhood: "Midtown", imageUrl: "venue-images/campbell.jpeg" },
      { id: "junglebird", name: "Jungle Bird", address: "174 8th Ave, NY", lat: 40.7429, lng: -74.0011, website: "https://junglebirdnyc.com", brand: "St. Agrestis, Ritual Zero Proof, Lyre's, Pathfinder", neighborhood: "Chelsea", imageUrl: "venue-images/junglebird.jpeg" },
      { id: "sempreoggi", name: "Sempre Oggi", address: "164 W 75th St, NY", lat: 40.7803, lng: -73.9799, website: "https://www.semprenyc.com", brand: "St. Agrestis, Athletic Brewing Co.", neighborhood: "Upper West Side", imageUrl: "venue-images/sempreoggi.jpeg" },
      { id: "wolfe", name: "The Wolfe", address: "425 Amsterdam Ave, NY", lat: 40.7868, lng: -73.9783, website: "https://www.thewolfenyc.com", brand: "St. Agrestis, Lyre's, Athletic Brewing Co.", neighborhood: "Upper West Side", imageUrl: "venue-images/wolfe.jpeg" },
      { id: "elea", name: "Elea", address: "217 W 85th St, NY", lat: 40.7893, lng: -73.9766, website: "https://eleanyc.com", brand: "Ritual Zero Proof", neighborhood: "Upper West Side", imageUrl: "venue-images/elea.jpeg" },
      { id: "friendfarmer", name: "Friend of a Farmer", address: "68 W 71st St, NY", lat: 40.7782, lng: -73.9791, website: "https://www.friendofafarmer.com", brand: "Seedlip, Ghia, Athletic Brewing Co.", neighborhood: "Upper West Side", imageUrl: "venue-images/friendfarmer.jpeg" },
      { id: "pendry", name: "Bar Pendry", address: "438 W 33rd St, NY", lat: 40.7536, lng: -73.9934, website: "https://www.pendry.com/manhattan-west/", brand: "Lyre's", neighborhood: "Midtown", imageUrl: "venue-images/barpendry.jpeg" },
      { id: "portrait", name: "The Portrait Bar", address: "1 W 28th St, NY", lat: 40.745, lng: -73.9886, website: "https://www.theportraitbar.com", brand: "Apl√≥s, Seedlip, Ritual Zero Proof, Athletic Brewing Co.", neighborhood: "Midtown", imageUrl: "venue-images/portraitbar.jpeg" },
      { id: "clemente", name: "Clemente Bar", address: "11 Madison Ave, NY", lat: 40.7417, lng: -73.9872, website: "https://www.clementebar.com", brand: "Seedlip, Athletic Brewing Co.", neighborhood: "Flatiron", imageUrl: "venue-images/clemente.jpeg" },
      { id: "delfriscogrille", name: "Del Frisco's Grille", address: "50 Rockefeller Plaza, NY", lat: 40.759, lng: -73.9799, website: "https://www.delfriscosgrille.com", brand: "Apl√≥s, Ritual Zero Proof", neighborhood: "Midtown", imageUrl: "venue-images/delfriscoe.jpeg" },
      { id: "cosme", name: "Cosme", address: "35 E 21st St, NY", lat: 40.7396, lng: -73.9884, website: "https://cosmenyc.com", brand: "Seedlip", neighborhood: "Flatiron", imageUrl: "venue-images/cosme.jpeg" },
      { id: "calico", name: "Bar Calico", address: "23 Lexington Ave, NY", lat: 40.7415, lng: -73.9874, website: "https://barcaliconyc.com", brand: "Ritual Zero Proof, Seedlip", neighborhood: "Flatiron", imageUrl: "venue-images/barcalico.jpeg" },
      { id: "lobbyedition", name: "Lobby Bar at The Edition", address: "5 Madison Ave, NY", lat: 40.742, lng: -73.987, website: "https://www.editionhotels.com/new-york/restaurants-and-bars/lobby-bar/", brand: "Lyre's", neighborhood: "Flatiron", imageUrl: "venue-images/lobbybaredition.jpeg" },
      { id: "lamericana", name: "L'Americana", address: "51 Irving Place, NY", lat: 40.7375, lng: -73.9854, website: "https://www.lamericana-nyc.com", brand: "Seedlip, Good Time Brewing", neighborhood: "Gramercy", imageUrl: "venue-images/lamericana.jpeg" },
      { id: "handcraft", name: "Handcraft Kitchen & Cocktails", address: "367 3rd Ave, NY", lat: 40.7429, lng: -73.9796, website: "https://www.handcraftnyc.com", brand: "Seedlip, Lyre's, Ritual Zero Proof", neighborhood: "Midtown", imageUrl: "venue-images/handcraft.jpeg" },
      { id: "decoy", name: "Decoy", address: "529 Hudson St, NY", lat: 40.7348, lng: -74.0061, website: "https://www.decoynyc.com", brand: "Seedlip", neighborhood: "West Village", imageUrl: "venue-images/decoy.jpeg" },
      { id: "dante", name: "Dante West Village", address: "551 Hudson St, NY", lat: 40.7353, lng: -74.0054, website: "https://www.dante-nyc.com/wv/", brand: "Seedlip, Lyre's", neighborhood: "West Village", imageUrl: "venue-images/dante.jpeg" },
      { id: "hudsonhound", name: "Hudson Hound", address: "575 Hudson St, NY", lat: 40.7361, lng: -74.0063, website: "https://hudsonhoundnyc.com", brand: "Lyre's", neighborhood: "West Village", imageUrl: "venue-images/hudsonhound.jpeg" },
      { id: "wilfienell", name: "Wilfie & Nell", address: "228 W 4th St, NY", lat: 40.7338, lng: -74.0028, website: "https://www.wilfieandnell.com", brand: "Seedlip, Athletic Brewing Co., Good Time Brewing", neighborhood: "West Village", imageUrl: "venue-images/wilfienell.jpeg" },
      { id: "fiddlesticks", name: "Fiddlesticks Pub", address: "56 Greenwich Ave, NY", lat: 40.7359, lng: -74.0021, website: "https://www.fiddlesticksnyc.net", brand: "St. Agrestis, Seedlip", neighborhood: "West Village", imageUrl: "venue-images/fiddlesticks.jpeg" },
      { id: "deathco", name: "Death & Co", address: "433 E 6th St, NY", lat: 40.7275, lng: -73.9846, website: "https://www.deathandcompany.com", brand: "Pathfinder, Seedlip, Ritual Zero Proof, Lyre's", neighborhood: "East Village", imageUrl: "venue-images/deathco.jpeg" },
      { id: "pineappleclub", name: "Pineapple Club", address: "509 E 6th St, NY", lat: 40.7268, lng: -73.9789, website: "http://pineappleclub.com", brand: "St. Agrestis", neighborhood: "East Village", imageUrl: "venue-images/pineappleclub.jpeg" },
      { id: "hardtoexplain", name: "Hard to Explain", address: "224 E 10th St, NY", lat: 40.7299, lng: -73.9831, website: "https://www.hardtoexplain.co", brand: "Good Time Brewing", neighborhood: "East Village", imageUrl: "venue-images/hardtoexplain.jpeg" },
      { id: "superbueno", name: "Superbueno", address: "13 1st Ave, NY", lat: 40.7273, lng: -73.9896, website: "https://www.superbuenonyc.com", brand: "Pathfinder, Curious Elixirs, Apl√≥s, Good Time Brewing", neighborhood: "East Village", imageUrl: "venue-images/superbueno.jpeg" },
      { id: "donna", name: "Donna", address: "7 Cornelia St, NY", lat: 40.7316, lng: -74.0035, website: "https://www.donnanyc.com", brand: "Ritual Zero Proof, St. Agrestis, Pathfinder", neighborhood: "West Village", imageUrl: "venue-images/donna.jpeg" },
      { id: "entwine", name: "Entwine Cocktail Bar", address: "765 Washington St, NY", lat: 40.7342, lng: -74.0062, website: "https://www.entwinenyc.com", brand: "Athletic Brewing Co., St. Agrestis", neighborhood: "West Village", imageUrl: "venue-images/entwine.jpeg" },
      { id: "onewhite", name: "One White Street", address: "1 White St, NY", lat: 40.7167, lng: -74.0081, website: "https://www.onewhitestreetnyc.com", brand: "Seedlip, Pathfinder, St. Agrestis, Athletic Brewing Co.", neighborhood: "Tribeca", imageUrl: "venue-images/onewhite.jpeg" },
      { id: "macao", name: "Macao Trading Company", address: "311 Church St, NY", lat: 40.7178, lng: -74.0092, website: "https://www.macaonyc.com", brand: "Pathfinder, Athletic Brewing Co.", neighborhood: "Tribeca", imageUrl: "venue-images/macao.jpeg" },
      { id: "sainttuesday", name: "Saint Tuesday", address: "24 Cortlandt Alley, NY", lat: 40.7174, lng: -74.0060, website: "https://www.sainttuesdaynyc.com", brand: "Lyre's, Pathfinder, Ghia", neighborhood: "Tribeca", imageUrl: "venue-images/sainttuesday.jpeg" },
      { id: "northbar", name: "North Bar", address: "458 Greenwich St, NY", lat: 40.7204, lng: -74.0097, website: "http://northbartribeca.com", brand: "Athletic Brewing Co.", neighborhood: "Tribeca", imageUrl: "venue-images/northbar.jpeg" },
      { id: "bridges", name: "Bridges", address: "9 Chatham Sq, NY", lat: 40.7135, lng: -73.9981, website: "https://www.bridges-nyc.com", brand: "Lyre's, Pathfinder, Good Time Brewing", neighborhood: "Tribeca", imageUrl: "venue-images/bridges.jpeg" },
      { id: "trinity", name: "Trinity Place", address: "115 Broadway, NY", lat: 40.7070, lng: -74.0112, website: "https://www.trinityplacenyc.com", brand: "Lyre's, Athletic Brewing Co.", neighborhood: "FiDi", imageUrl: "venue-images/trinity.jpeg" },
      { id: "barbelly", name: "Bar Belly", address: "14 Orchard St, NY", lat: 40.7168, lng: -73.9910, website: "https://www.barbellynyc.com", brand: "Pathfinder, Seedlip, Good Time Brewing", neighborhood: "East Village", imageUrl: "venue-images/barbelly.jpeg" },
      { id: "luckytiger", name: "Lucky Tiger", address: "66 Pearl St, NY", lat: 40.7075, lng: -74.0026, website: "https://www.luckytigernyc.com", brand: "St. Agrestis", neighborhood: "FiDi", imageUrl: "venue-images/luckytiger.jpeg" },
      { id: "bedford", name: "The Bedford", address: "55 Stone St, NY", lat: 40.7263, lng: -73.9819, website: "https://www.thebedford.nyc", brand: "Seedlip", neighborhood: "FiDi", imageUrl: "venue-images/bedford.jpeg" },
      { id: "tradewell", name: "Tradwell Park", address: "301 S End Ave, NY", lat: 40.7160, lng: -74.0105, website: "https://www.treadwellpark.com/location/downtown/", brand: "Lyre's, Athletic Brewing Co.", neighborhood: "Tribeca", imageUrl: "venue-images/tradewellpark.jpeg" },
      { id: "tizio", name: "Bar Tizio", address: "107 Horatio St, NY", lat: 40.7358, lng: -74.0050, website: "https://www.bartizio.com", brand: "St. Agrestis", neighborhood: "West Village", imageUrl: "venue-images/bartizio.jpeg" },
      { id: "grovestreet", name: "Grove Street Social", address: "39 Grove St, NY", lat: 40.7337, lng: -74.0021, website: "https://www.grovestreetsocial.com", brand: "Guinness, Heineken, Curious Elixirs", neighborhood: "West Village", imageUrl: "venue-images/grovestreetsocial.jpeg" },
      { id: "artbar", name: "Art Bar", address: "52 8th Ave, NY", lat: 40.7390, lng: -74.0039, website: "https://www.artbarnyc.com", brand: "Ghia, Guinness, Athletic Brewing Co.", neighborhood: "West Village", imageUrl: "venue-images/artbar.jpeg" }, 
      { id: "marlow", name: "Marlow East", address: "1015 Lexington Ave, NY", lat: 40.7716, lng: -73.9607, website: "https://www.marloweast.com", brand: "Ghia, Pathfinder", neighborhood: "Upper East Side", imageUrl: "venue-images/marlow.jpeg" },
      { id: "cafefiorello", name: "Cafe Fiorello", address: "1900 Broadway, NY", lat: 40.7713, lng: -73.9819, website: "https://www.cafefiorello.com", brand: "Lyre's, St. Agrestis, Athletic Brewing Co.", neighborhood: "Upper West Side", imageUrl: "venue-images/cafefiorello.jpeg" },
      { id: "parisbar", name: "Paris Bar", address: "120 W 57th St, NY", lat: 40.7640, lng: -73.9776, website: "https://www.parisbar.com", brand: "Lyre's, Ghia, Athletic Brewing Co.", neighborhood: "Midtown", imageUrl: "venue-images/parisbar.jpeg" },
      { id: "tartinery", name: "Tartinery", address: "2090 Broadway, NY", lat: 40.7782, lng: -73.9813, website: "https://www.tartinery.com", brand: "Ghia", neighborhood: "Upper West Side", imageUrl: "venue-images/tartinery.jpeg" },
      { id: "pjclarkes", name: "P.J. Clarke's", address: "4 Columbus Cir, NY", lat: 40.7680, lng: -73.9836, website: "https://www.pjclarkes.com", brand: "Athletic Brewing Co., Heineken, Ghia, Lyre's", neighborhood: "Upper West Side", imageUrl: "venue-images/pjclarkeuws.jpeg" },
      { id: "empirerooftop", name: "The Empire Rooftop", address: "44 W 63rd St, NY", lat: 40.7719, lng: -73.9832, website: "https://www.theempirerooftop.com", brand: "Run Wild, Corona, Lyre's, St. Agrestis, Ritual Zero Proof", neighborhood: "Upper West Side", imageUrl: "venue-images/empireroof.jpeg" },
      { id: "allurebar", name: "Allure Bar", address: "80 Riverside Blvd, NY", lat: 40.7807, lng: -73.9886, website: "https://www.allurebar.com", brand: "Seedlip, Run Wild", neighborhood: "Upper West Side", imageUrl: "venue-images/allurebar.jpeg" },
      { id: "parklane", name: "Park Lane", address: "36 Central Park S, NY", lat: 40.7666, lng: -73.9777, website: "https://www.parklanenewyork.com", brand: "Curious Elixirs", neighborhood: "Midtown", imageUrl: "venue-images/parklane.jpeg" },
      { id: "cotta", name: "Cotta", address: "513 Columbus Ave, NY", lat: 40.7871, lng: -73.9725, website: "https://www.cottanyc.com", brand: "Curious Elixirs, St. Agrestis, Good Time Brewing", neighborhood: "Upper West Side", imageUrl: "venue-images/cotta.jpeg" },
      { id: "spaniard", name: "The Spaniard", address: "190 W 4th St, NY", lat: 40.7346, lng: -74.0007, website: "https://www.thespaniardnyc.com", brand: "Curious Elixirs, St. Agrestis, Seedlip, Good Time Brewing", neighborhood: "West Village", imageUrl: "venue-images/spaniard.jpeg" },
      { id: "peckslip", name: "Peck Slip Social", address: "36 Peck Slip, NY", lat: 40.7079, lng: -74.0016, website: "https://www.peckslipsocial.com", brand: "Curious Elixirs, Guinness, St. Agrestis", neighborhood: "FiDi", imageUrl: "venue-images/peckslip.jpeg" },
      { id: "shyshy", name: "Shy Shy", address: "520 W 27th St, NY", lat: 40.7502, lng: -74.0049, website: "https://www.shyshynyc.com", brand: "Ritual Zero Proof, Pentire, Giffard", neighborhood: "Chelsea", imageUrl: "venue-images/shyshy.jpeg" },
      { id: "markette", name: "Markette", address: "135 W 24th St, NY", lat: 40.7447, lng: -73.9944, website: "https://www.markettenyc.com", brand: "St. Agrestis", neighborhood: "Chelsea", imageUrl: "venue-images/markette.jpeg" },
      { id: "hellohello", name: "Hello Hello Bar", address: "138 W 26th St, NY", lat: 40.7456, lng: -73.9936, website: "https://www.hellohellonyc.com", brand: "Pathfinder, Apl√≥s, Good Time Brewing", neighborhood: "Chelsea", imageUrl: "venue-images/hellohello.jpeg" },
      { id: "littlerebel", name: "Little Rebel", address: "129 Orchard St, NY", lat: 40.7201, lng: -73.9889, website: "https://www.littlerebelnyc.com", brand: "Lyre's, Seedlip", neighborhood: "East Village", imageUrl: "venue-images/littlerebel.jpeg" },
      { id: "cabinet", name: "The Cabinet", address: "649 E 9th St, NY", lat: 40.7264, lng: -73.9794, website: "https://www.thecabinetnyc.com", brand: "Athletic Brewing Co.", neighborhood: "East Village", imageUrl: "venue-images/thecabinet.jpeg" },
      { id: "dutch", name: "The Dutch", address: "131 Sullivan St, NY", lat: 40.7259, lng: -74.0013, website: "https://www.thedutchnyc.com", brand: "Apl√≥s, Pentire, Ritual Zero Proof, Pathfinder", neighborhood: "SoHo", imageUrl: "venue-images/thedutch.jpeg" },
      { id: "raon", name: "Raon", address: "119 E 54th St, NY", lat: 40.7596, lng: -73.9692, website: "https://www.raonnyc.com", brand: "Seedlip, Pentire, Apl√≥s", neighborhood: "Upper East Side", imageUrl: "venue-images/raon.jpeg" },
      { id: "nothingrmatters", name: "Nothing Really Matters", address: "30 W 48th St, NY", lat: 40.7571, lng: -73.9815, website: "https://www.nothingreallymatters.bar", brand: "Lager, Apl√≥s", neighborhood: "Midtown", imageUrl: "venue-images/nothingreallymatters.jpeg" },
      { id: "dutchfreds", name: "Dutch Freds", address: "307 W 47th St, NY", lat: 40.7597, lng: -73.9883, website: "https://www.dutchfreds.com", brand: "Good Time Brewing, Stella Artois, Guinness, Apl√≥s", neighborhood: "Midtown", imageUrl: "venue-images/dutchfreds.jpeg" },
      { id: "cuerno", name: "Cuerno", address: "52 W 54th St, NY", lat: 40.7613, lng: -73.9785, website: "https://www.cuernonyc.com", brand: "Ritual Zero Proof, Corona", neighborhood: "Midtown", imageUrl: "venue-images/cuerno.jpeg" },
      { id: "felicehudson", name: "Felice on Hudson", address: "15 W 3rd St, NY", lat: 40.7327, lng: -74.0030, website: "https://www.felicerestaurants.com", brand: "Ghia, Peroni, Lyre's", neighborhood: "West Village", imageUrl: "venue-images/felicehudson.jpeg" },
      { id: "parkgate", name: "The Park Gate", address: "91 Christopher St, NY", lat: 40.7338, lng: -74.0057, website: "https://www.theparkgatenyc.com", brand: "Guinness, Good Time Brewing, Athletic Brewing Co., Lyre's", neighborhood: "West Village", imageUrl: "venue-images/parkgate.jpeg" },
      { id: "americanbar", name: "American Bar", address: "33 Greenwich Ave, NY", lat: 40.7352, lng: -74.0026, website: "https://www.americanbarnyc.com", brand: "Pentire, Kin Euphorics, Seedlip", neighborhood: "West Village", imageUrl: "venue-images/americanbar.jpeg" },
      { id: "travelerspoets", name: "Travelers Poets & Friends", address: "442 Hudson St, NY", lat: 40.7320, lng: -74.0067, website: "https://www.travelersnyc.com", brand: "Pathfinder, St. Agrestis", neighborhood: "West Village", imageUrl: "venue-images/travelerspoets.jpeg" },
      { id: "53", name: "53", address: "53 W 53rd St, NY", lat: 40.7610, lng: -73.9776, website: "https://www.53-nyc.com", brand: "Lyre's, Pentire, Pathfinder, St. Agrestis", neighborhood: "Midtown", imageUrl: "venue-images/53nyc.jpeg" },
      { id: "naro", name: "Naro", address: "10 Rockefeller Plaza, NY", lat: 40.7587, lng: -73.9787, website: "https://www.naronyc.com", brand: "Seedlip, Apl√≥s", neighborhood: "Midtown", imageUrl: "venue-images/naro.jpeg" },
      { id: "king", name: "King", address: "18 King St, NY", lat: 40.7276, lng: -74.0036, website: "https://www.kingrestaurant.nyc", brand: "Ghia, Lyre's, Athletic Brewing Co.",neighborhood: "SoHo", imageUrl: "venue-images/kingbar.jpeg" },
      { id: "carnemare", name: "Carne Mare", address: "89 South St, NY", lat: 40.7062, lng: -74.0034, website: "https://www.carnemare.com", brand: "Athletic Brewing Co., Pentire, Lyre's", neighborhood: "FiDi", imageUrl: "venue-images/carnemare.jpeg" },

    ];

// =========================
// Embed mode flag (?embed=1)
// =========================
window.SipSober = window.SipSober || {};

(function () {
  const params = new URLSearchParams(window.location.search);
  const isEmbed = params.get("embed") === "1";

  window.SipSober.isEmbed = isEmbed;

  if (isEmbed) {
    document.body.classList.add("ss-embed");
  }
})();
    
// ======================================
// Near Me safety: ensure map is ready
// ======================================
let _mapReady = false;
let _pendingNearMe = null;
    
// ================================
// Near Me (Swift ‚Üí JS)
// ================================
let _nearMeActive = false;
let _nearMeCenter = null;
let _nearMeRadiusMiles = 2;

// snapshot of the "normal" dataset so Clear can restore
let _baseLocationsSnapshot = null;

// Haversine distance (meters)
function distanceMeters(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const toRad = (x) => (x * Math.PI) / 180;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);

  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(toRad(lat1)) *
      Math.cos(toRad(lat2)) *
      Math.sin(dLon / 2) ** 2;

  return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// Core: re-render using current filters/search, then optionally apply Near Me
function applyFiltersWithNearMe() {
  closeAllMenus();

  const selectedBrands = getSelectedValues("brand");
  const selectedNeighborhoods = getSelectedValues("n");

  const q = (document.getElementById("searchTopInput")?.value || "").trim();
  const hasSearch = q.length > 0;

  // 1) Apply your existing filters/search
  let filtered = locations.filter((loc) => {
    const brandOK = selectedBrands.length
      ? selectedBrands.some(
          (b) => loc.brand && loc.brand.toLowerCase().includes(b.toLowerCase())
        )
      : true;

    const hoodOK = selectedNeighborhoods.length
      ? selectedNeighborhoods.includes(loc.neighborhood)
      : true;

    const searchOK = matchesSearch(loc, q);

    return brandOK && hoodOK && searchOK;
  });

  // 2) If Near Me is active, apply distance filter + sort
  if (_nearMeActive && _nearMeCenter) {
    const radiusMeters = (_nearMeRadiusMiles || 2) * 1609.34;

    filtered = filtered
      .map((v) => ({
        ...v,
        _dist: distanceMeters(_nearMeCenter.lat, _nearMeCenter.lng, v.lat, v.lng),
      }))
      .filter((v) => Number.isFinite(v._dist) && v._dist <= radiusMeters)
      .sort((a, b) => a._dist - b._dist);
  }

  // 3) Render
  renderList(filtered);
  const { count, bounds } = renderMarkers(filtered);
  updateActiveFilters(selectedBrands, selectedNeighborhoods);

  // 4) Zoom behavior
  const panel = document.getElementById("bottom-panel");
  const panelH = panel ? panel.getBoundingClientRect().height : 0;

  // If Near Me is active, fit to results + user location (best UX)
  if (_nearMeActive && _nearMeCenter) {
    if (filtered.length) {
      const b = L.latLngBounds(filtered.map((v) => [v.lat, v.lng]));
      b.extend([_nearMeCenter.lat, _nearMeCenter.lng]);
      map.fitBounds(b, {
        paddingTopLeft: [16, (window.SipSober?.isEmbed ? 70 : 110)],
        paddingBottomRight: [16, panelH + 16],
        maxZoom: 16,
      });
    } else {
      map.setView([_nearMeCenter.lat, _nearMeCenter.lng], 15, { animate: true });
    }
  } else if (count > 0 && bounds && !hasSearch) {
    map.fitBounds(bounds, {
      paddingTopLeft: [16, (window.SipSober?.isEmbed ? 70 : 110)],
      paddingBottomRight: [16, panelH + 16],
      maxZoom: 16,
    });
  }

  window.filteredBounds = bounds;
  setTimeout(() => map.invalidateSize(true), 120);
}

let _lastSetUserLocationAt = 0;

// Swift calls this: window.SipSober.setUserLocation(lat, lng, miles)
window.SipSober.setUserLocation = function (lat, lng, radiusMiles) {
  _lastSetUserLocationAt = Date.now();

  if (!_mapReady) {
    _pendingNearMe = { lat, lng, radiusMiles };
    return;
  }

  console.log("üìç setUserLocation()", {
    lat, lng, radiusMiles,
    before: { _nearMeActive, _nearMeCenter, _nearMeRadiusMiles }
  });

  _nearMeActive = true;
  _nearMeCenter = { lat: Number(lat), lng: Number(lng) };
  _nearMeRadiusMiles = Number(radiusMiles || 2);

  if (!_baseLocationsSnapshot) _baseLocationsSnapshot = locations.slice();

  applyFiltersWithNearMe();

  const panel = document.getElementById("bottom-panel");
  if (panel) panel.classList.add("expanded");
};

// Swift calls this: window.SipSober.clearUserLocation()
window.SipSober.clearUserLocation = function () {
  const dt = Date.now() - _lastSetUserLocationAt;

  console.log("üßπ clearUserLocation()", {
    dtMsSinceSet: dt,
    before: { _nearMeActive, _nearMeCenter, _nearMeRadiusMiles }
  });

  // ‚úÖ Flicker killer:
  // If a "clear" arrives immediately after a "set", ignore it.
  // (This protects you from SwiftUI updateUIView briefly sending clear.)
  if (dt >= 0 && dt < 1200) {
    console.log("üßØ clearUserLocation ignored (debounced)");
    return;
  }

  if (!_mapReady) {
    _pendingNearMe = null;
    return;
  }
  
  _nearMeActive = false;
  _nearMeCenter = null;

  applyFiltersWithNearMe();
};

    /* =========================
   B) MAP INIT
   ========================= */
const map = L.map("map", {
  zoomControl: true,
  scrollWheelZoom: true,
}).setView([40.755, -73.985], 12.1);

window.SipSober = window.SipSober || {};
window.SipSober.closePopup = function () {
  try { map.closePopup(); } catch (e) {}
};
    
L.tileLayer(
  "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
  {
    maxZoom: 20,
    subdomains: "abcd",
    attribution: "&copy; OpenStreetMap contributors &copy; CARTO",
  }
).addTo(map);

const manhattanLockBounds = L.latLngBounds(
  [40.5, -74.3],
  [40.98, -73.6]
);

// ‚úÖ INITIAL view bounds (tighter, for startup framing)
const manhattanInitialBounds = L.latLngBounds(
  [40.70, -74.05],
  [40.88, -73.90]
);

// ‚úÖ HELPER GOES HERE
function fitInitialView() {
  const panel = document.getElementById("bottom-panel");
  const panelH = panel ? panel.getBoundingClientRect().height : 0;

  map.fitBounds(manhattanInitialBounds, {
    paddingTopLeft: [16, (window.SipSober?.isEmbed ? 70 : 110)],            
    paddingBottomRight: [16, panelH + 16] // space above bottom panel
  });
}

function resetToDefaultMapState() {
  // 1) Turn off Near Me
  _nearMeActive = false;
  _nearMeCenter = null;

  // 1.5) Close any open UI (dropdowns + search)
  closeAllMenus();
  document.getElementById("searchTopRow")?.classList.remove("is-open");
  document.getElementById("searchToggle")?.setAttribute("aria-expanded", "false");

  // 2) Clear filters
  document.querySelectorAll('input[id^="brand-"], input[id^="n-"]').forEach(cb => {
    cb.checked = false;
  });

  // 3) Clear search
  const searchInput = document.getElementById("searchTopInput");
  if (searchInput) searchInput.value = "";

  // 4) Render full dataset
  renderList(locations);
  renderMarkers(locations);

  // 5) Reset UI chips
  updateActiveFilters([], []);

  // 6) Reset map view
  setTimeout(() => {
    map.invalidateSize(true);
    fitInitialView();
  }, 80);
}

  // ‚úÖ Used when jumping to a single venue from Discover
function resetForFocusOnly() {
  // Turn off Near Me
  _nearMeActive = false;
  _nearMeCenter = null;

  // Close menus / search UI
  closeAllMenus();
  document.getElementById("searchTopRow")?.classList.remove("is-open");
  document.getElementById("searchToggle")?.setAttribute("aria-expanded", "false");

  // Clear filters
  document
    .querySelectorAll('input[id^="brand-"], input[id^="n-"]')
    .forEach(cb => cb.checked = false);

  // Clear search
  const searchInput = document.getElementById("searchTopInput");
  if (searchInput) searchInput.value = "";

  // IMPORTANT: re-render full dataset so marker exists
  renderList(locations);
  renderMarkers(locations);

  updateActiveFilters([], []);
}

// Lock + limits (DO NOT fit here)
map.setMaxBounds(manhattanLockBounds);
map.options.maxBoundsViscosity = 0.1;
map.setMinZoom(11.5);

markersLayer = L.layerGroup().addTo(map);

// ‚úÖ Near Me safety: mark map ready + flush any queued Near Me call
_mapReady = true;

if (_pendingNearMe) {
  window.SipSober.setUserLocation(
    _pendingNearMe.lat,
    _pendingNearMe.lng,
    _pendingNearMe.radiusMiles
  );
    _pendingNearMe = null;
}

    /* =========================
   C) ICONS (default + active)
   ========================= */
function makePinIconSVG(hex = "#202329", size = [28, 38], opts = {}) {
  const [w, h] = size;
  const ring = opts.ring ?? false;

  const stroke = "rgba(0,0,0,0.22)";
  const strokeW = 0.9;

  const ringColor = "rgba(32,34,57,0.28)";
  const ringW = 3;

  return `
    <svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}" viewBox="0 0 28 38">
      ${
        ring
          ? `<path d="M14 0C6.82 0 1 5.82 1 13c0 9.75 11.4 23.4 12.01 24.13a1.25 1.25 0 0 0 1.98 0C15.6 36.4 27 22.75 27 13 27 5.82 21.18 0 14 0z"
               fill="none" stroke="${ringColor}" stroke-width="${ringW}" />`
          : ""
      }

      <path d="M14 0C6.82 0 1 5.82 1 13c0 9.75 11.4 23.4 12.01 24.13a1.25 1.25 0 0 0 1.98 0C15.6 36.4 27 22.75 27 13 27 5.82 21.18 0 14 0z"
            fill="${hex}" stroke="${stroke}" stroke-width="${strokeW}"/>

      <circle cx="14" cy="13" r="5.2" fill="#fff"/>
    </svg>`;
}

function makeIcon(size = [28, 38], color = "#202329", isActive = false) {
  return L.icon({
    iconUrl:
      "data:image/svg+xml;utf8," +
      encodeURIComponent(makePinIconSVG(color, size, { ring: isActive })),
    iconSize: size,
    iconAnchor: [Math.floor(size[0] / 2), size[1]],
    popupAnchor: [0, -Math.floor(size[1] * 0.84)],
  });
}

let defaultIcon = makeIcon([28, 38], "#202329", false);
let activeIcon  = makeIcon([28, 38], "#202329", true);

let currentIcon = defaultIcon;

// Apply to ALL markers created without an explicit icon
L.Marker.prototype.options.icon = currentIcon;

// Force any L.marker(...) calls to use currentIcon unless overridden
const __origMarkerFactory = L.marker;
L.marker = function (latlng, options) {
  const opts = options || {};
  if (!opts.icon) opts.icon = currentIcon;
  return __origMarkerFactory.call(this, latlng, opts);
};

// Track which marker is "active"
let _activeMarker = null;

function setActiveMarker(marker) {
  if (_activeMarker && _activeMarker !== marker) {
    _activeMarker.setIcon(defaultIcon);
  }
  _activeMarker = marker || null;
  if (_activeMarker) _activeMarker.setIcon(activeIcon);
}

function clearActiveMarker() {
  if (_activeMarker) _activeMarker.setIcon(defaultIcon);
  _activeMarker = null;
}

// Resize icons for mobile/desktop and keep active state consistent
const mobileQuery = window.matchMedia("(max-width: 767px)");
function applyIconForViewport() {
  const isMobile = mobileQuery.matches;
  const size = isMobile ? [18, 26] : [28, 38];

  defaultIcon = makeIcon(size, "#202329", false);
  activeIcon  = makeIcon(size, "#202329", true);

  currentIcon = defaultIcon;
  L.Marker.prototype.options.icon = currentIcon;

  if (markersLayer && markersLayer.eachLayer) {
    markersLayer.eachLayer((layer) => {
      if (!layer || typeof layer.setIcon !== "function") return;
      // if this is the active marker, keep it active icon
      layer.setIcon(layer === _activeMarker ? activeIcon : defaultIcon);
    });
  }
}
applyIconForViewport();
mobileQuery.addEventListener("change", applyIconForViewport);

// Clear highlight when popup closes
map.on("popupclose", () => {
  clearActiveMarker();
  _lastFocusedVenueId = null;
});


    /* =========================
       D) UI HELPERS
       ========================= */
    function closeAllMenus() {
      document
        .querySelectorAll(".dropdown")
        .forEach((dd) => dd.classList.remove("open"));
      document
        .querySelectorAll(".dropdown > button")
        .forEach((btn) => btn.setAttribute("aria-expanded", "false"));
    }

    function openMarkerAt(lat, lng) {
      let found = null;
      markersLayer.eachLayer((layer) => {
        const p = layer.getLatLng();
        if (Math.abs(p.lat - lat) < 1e-6 && Math.abs(p.lng - lng) < 1e-6) {
          found = layer;
        }
      });
      if (found) {
        found.openPopup();
      }
    }

    /* =========================
       E) RENDERERS
       ========================= */
    var markersById = {};

    function normalizeUrl(u) {
      u = String(u || "").trim();
      if (!u || u.toLowerCase() === "n/a") return "";
      if (!/^https?:\/\//i.test(u)) u = "https://" + u;
      return u;
    }

   // =====================================
// 3A) Web ‚Üí Swift: send venues for native Search
// =====================================
window.SipSober = window.SipSober || {};
let _didSendVenuesToNative = false;

function _brandsArrayFromString(s) {
  return String(s || "")
    .split(",")
    .map(x => x.trim())
    .filter(Boolean);
}

function _venueForNative(loc) {
  return {
    id: String(loc.id || ""),
    name: String(loc.name || ""),
    address: String(loc.address || ""),
    neighborhood: String(loc.neighborhood || ""),
    brands: _brandsArrayFromString(loc.brand),
    website: normalizeUrl(loc.website || ""),
    lat: Number(loc.lat || 0),
    lng: Number(loc.lng || 0),
    imageUrl: String(loc.imageUrl || "")
  };
}

window.SipSober.sendVenuesToNative = function (arg) {
  try {
    // ‚úÖ Allow both usages:
    // 1) sendVenuesToNative(true)            -> force full send
    // 2) sendVenuesToNative(filteredData)    -> send exactly what's rendered
    const force = (typeof arg === "boolean") ? arg : false;
    const source = Array.isArray(arg) ? arg : (locations || []);

    if (_didSendVenuesToNative && !force && !Array.isArray(arg)) return;

    const venues = source
      .map(_venueForNative)
      .filter(v => v.id && v.name);

    if (window.webkit?.messageHandlers?.sipSober) {
      window.webkit.messageHandlers.sipSober.postMessage({
        type: "venues",
        venues
      });
      _didSendVenuesToNative = true;
      console.log("‚úÖ sent venues to native:", venues.length);
    } else {
      console.log("sipSober handler not available");
    }
  } catch (e) {
    console.log("sendVenuesToNative error", e);
  }
};

// Send once after load (safety)
window.addEventListener("load", () => {
  setTimeout(() => window.SipSober.sendVenuesToNative(), 400);
});

    function renderMarkers(data) {
  markersLayer.clearLayers();
  clearActiveMarker();
  markersById = {};
  const bounds = L.latLngBounds([]);

  data.forEach((loc) => {
  const m = L.marker([loc.lat, loc.lng]).addTo(markersLayer);
  m.on("click", () => setActiveMarker(m));


  if (loc.id) markersById[String(loc.id)] = m;

  const imgHtml = loc.imageUrl
    ? `
      <div class="ss-popup-img-wrap">
        <img class="ss-popup-img" src="${loc.imageUrl}" alt="${loc.name || ""}" loading="lazy"
          onerror="this.closest('.ss-popup-img-wrap')?.remove()">
      </div>
    `
    : "";

  m.bindPopup(
    `
    <div class="ss-popup ss-popup--simple">
      <div class="ss-popup-top">
        ${imgHtml}

        <div class="ss-popup-text">
          <div class="ss-popup-title">${loc.name || ""}</div>

          ${loc.neighborhood ? `<div class="ss-popup-tags">${loc.neighborhood}</div>` : ""}

          <div class="ss-popup-meta">${loc.address || ""}</div>
          <div class="ss-popup-actions">
            ${
              normalizeUrl(loc.website)
                ? `
                  <a
                    class="ss-pill"
                    href="${normalizeUrl(loc.website)}"
                    target="_blank"
                    rel="noopener"
                  >
                    Website
                  </a>
                `
              : ""
            }

            <a
              class="ss-pill secondary"
              href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
                (loc.name || "") + " " + (loc.address || "")
              )}"
              target="_blank"
              rel="noopener"
            >
              Directions
            </a>
          </div>
        </div>
      </div>
    </div>
    `,
    {
  minWidth: 220,
  maxWidth: 280,
  closeButton: true,

  autoPan: true,
  keepInView: true,

  // Avoid your top controls + bottom sheet
  autoPanPaddingTopLeft: [18, 160],
  autoPanPaddingBottomRight: [18, 260],

  // Lift popup slightly
  offset: [0, -18]
}
  );

  bounds.extend([loc.lat, loc.lng]);
});

  return { count: data.length, bounds: data.length ? bounds : null };
}

    function renderList(data) {
  const results = document.getElementById("results");
  const resultsCount = document.getElementById("results-count");

  if (!results) return;

  results.innerHTML = "";

  // ‚úÖ update results count
  if (resultsCount) {
    resultsCount.textContent =
      data.length === 0
        ? "No places found"
        : `${data.length} place${data.length === 1 ? "" : "s"}`;
  }

  data.forEach((loc) => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="card-top">
        <span class="card-name" data-focus-id="${loc.id}">${loc.name}</span>
        <button class="fav-btn" data-id="${loc.id}" aria-label="Favorite">‚òÖ</button>
      </div>

      <div class="meta">${loc.address || ""}</div>
      ${
        loc.website
          ? `<a href="${loc.website}" target="_blank" rel="noopener">Website</a>`
          : ``
      }
      <div class="meta">Brand: ${loc.brand || ""}</div>
      <div class="meta">Neighborhood: ${loc.neighborhood || ""}</div>
    `;

    results.appendChild(card);
  });

  // ‚úÖ Web ‚Üí Swift: keep native Search list in sync
  window.SipSober?.sendVenuesToNative?.(data);
}

    /* =========================
       ACTIVE FILTER CHIPS
       ========================= */
    function updateActiveFilters(selectedBrands, selectedNeighborhoods) {
      const container = document.getElementById("active-filters");
      if (!container) return;

      container.innerHTML = "";

      const hasAny =
        selectedBrands.length || selectedNeighborhoods.length;
      container.style.display = hasAny ? "flex" : "none";
      if (!hasAny) return;

      function makePill(type, value) {
        const pill = document.createElement("span");
        pill.className = "filter-pill";

        const x = document.createElement("span");
        x.className = "filter-pill-x";
        x.textContent = "√ó";

        const label = document.createElement("span");
        label.textContent = value;

        x.addEventListener("click", () => {
          clearSingleFilter(type, value);
        });

        pill.appendChild(x);
        pill.appendChild(label);
        container.appendChild(pill);
      }

      selectedNeighborhoods.forEach((n) => makePill("neighborhood", n));
      selectedBrands.forEach((b) => makePill("brand", b));
    }

    function clearSingleFilter(type, value) {
      if (type === "brand") {
        document
          .querySelectorAll('input[id^="brand-"]')
          .forEach((cb) => {
            if (cb.value === value) cb.checked = false;
          });
      } else if (type === "neighborhood") {
        document.querySelectorAll('input[id^="n-"]').forEach((cb) => {
          if (cb.value === value) cb.checked = false;
        });
      }
        applyFiltersWithNearMe();

    }

    /* =========================
       F) FILTER LOGIC
       ========================= */
    function getSelectedValues(prefix) {
      return Array.from(
        document.querySelectorAll(`input[id^="${prefix}-"]:checked`)
      ).map((cb) => cb.value);
    }

    function matchesSearch(loc, q) {
      if (!q) return true;
        const hay = [loc.name, loc.address, loc.brand, loc.neighborhood]
          .filter(Boolean)
          .join(" ")
          .toLowerCase();
        return hay.includes(q.toLowerCase());
      }
    function applyFilters() {
  applyFiltersWithNearMe();
}

    /* =========================
   G) EVENT WIRING
   ========================= */

// ESC closes dropdowns
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closeAllMenus();
});

// ‚úÖ ONE unified click handler (favorites + venue focus + dropdown open/close + search row close)
document.addEventListener("click", (e) => {

  // If a link was clicked, allow navigation but still close menus/search
if (e.target.closest("a")) {
  closeAllMenus();
  document.getElementById("searchTopRow")?.classList.remove("is-open");
  document.getElementById("searchToggle")?.setAttribute("aria-expanded", "false");
  return;
}

  // 1) ‚≠ê Favorite button
  const favBtn = e.target.closest(".fav-btn");
  if (favBtn) {
    e.preventDefault();
    e.stopPropagation();

    const venueId = favBtn.dataset.id;
    const v = locations.find((x) => String(x.id) === String(venueId));
    if (!v) return;

    favBtn.classList.toggle("is-fav");

    window.webkit?.messageHandlers?.favorites?.postMessage({
      action: "toggle",
      venue: {
        venueId: String(v.id),
        name: v.name || "",
        address: v.address || "",
        website: v.website || "",
        neighborhood: v.neighborhood || "",
        brands: v.brand || "",
      },
    });

    return; // stop here so name-click logic doesn't run
  }

  // 2) üìç Venue name ‚Üí focus + zoom
  const nameEl = e.target.closest(".card-name[data-focus-id]");
  if (nameEl) {
    e.preventDefault();
    e.stopPropagation();
    window.SipSober?.focusVenue(nameEl.dataset.focusId);
    return;
  }

  // 3) Dropdown button toggle
  const btn = e.target.closest(".dropdown > button");
  if (btn) {
    const parent = btn.parentElement;
    const willOpen = !parent.classList.contains("open");

    closeAllMenus();
    if (willOpen) {
      parent.classList.add("open");
      btn.setAttribute("aria-expanded", "true");
    }
    return;
  }

  // 4) Click outside ‚Üí close dropdowns
  const clickedInsideDropdown = !!e.target.closest(".dropdown");
  if (!clickedInsideDropdown) closeAllMenus();

  // 5) Click outside search ‚Üí close search row if open
  const clickedInsideSearch =
    !!e.target.closest("#searchTopRow") || !!e.target.closest("#searchToggle");

  if (!clickedInsideSearch) {
    const row = document.getElementById("searchTopRow");
    if (row?.classList.contains("is-open")) {
      row.classList.remove("is-open");
      document.getElementById("searchToggle")?.setAttribute("aria-expanded", "false");
      document.getElementById("searchTopInput")?.blur();
    }
  }
});

// Keep aria wiring for menus
document.querySelectorAll(".dropdown > button").forEach((btn) => {
  btn.setAttribute("aria-haspopup", "true");
  const dd = btn.parentElement;
  const menu = dd.querySelector(".menu");
  if (dd && menu) {
    const id = dd.id ? dd.id + "-menu" : "menu-" + Math.random().toString(36).slice(2);
    menu.id = id;
    btn.setAttribute("aria-controls", id);
  }
});

// Go button applies filters + Near Me logic
document.getElementById("goBtn").addEventListener("click", applyFiltersWithNearMe);

// ==============================
// TOP SEARCH TOGGLE
// ==============================
(() => {
  const toggleBtn = document.getElementById("searchToggle");
  const row = document.getElementById("searchTopRow");
  const input = document.getElementById("searchTopInput");

  if (!toggleBtn || !row) return;

  function openRow() {
    row.classList.add("is-open");
    toggleBtn.setAttribute("aria-expanded", "true");
    setTimeout(() => input?.focus(), 50);
  }

  function closeRow() {
    row.classList.remove("is-open");
    toggleBtn.setAttribute("aria-expanded", "false");
    input?.blur();
  }

  // expose for the unified click handler (optional but clean)
  window.SipSober = window.SipSober || {};
  window.SipSober._openSearchRow = openRow;
  window.SipSober._closeSearchRow = closeRow;

  toggleBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    row.classList.contains("is-open") ? closeRow() : openRow();
  });
})();


    // ==============================
// TOP SEARCH (after Go button)
// ==============================

const searchInput = document.getElementById("searchTopInput");
const searchClear = document.getElementById("searchTopClear");

// Enter key = apply filters
searchInput?.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    applyFiltersWithNearMe();
    document.getElementById("searchTopRow")?.classList.remove("is-open");
    document.getElementById("searchToggle")?.setAttribute("aria-expanded","false");
    searchInput.blur();
  }
});

// Clear (√ó)
searchClear?.addEventListener("click", () => {
  if (searchInput) searchInput.value = "";
  applyFiltersWithNearMe();
});

  
// =========================
// Bottom panel expand / collapse toggle
// =========================
(function () {
  const panel = document.getElementById("bottom-panel");
  const toggle = document.getElementById("panel-toggle");
  const label = toggle?.querySelector(".label");

  if (!panel || !toggle) return;

  function syncLabel() {
    const expanded = panel.classList.contains("expanded");
    toggle.setAttribute("aria-expanded", expanded ? "true" : "false");
    if (label) label.textContent = expanded ? "Hide" : "Show";
  }

  // Toggle on tap
  toggle.addEventListener("click", (e) => {
    e.stopPropagation(); // important: prevents scrollIntoView interference
    panel.classList.toggle("expanded");
    syncLabel();
  });

  // Optional: auto-expand on mobile when results update
  if (window.matchMedia("(max-width: 768px)").matches) {
    panel.classList.add("expanded");
  }

  syncLabel();
})();

    /* =========================
       I) INITIALIZE
       ========================= */
    renderList(locations);
    renderMarkers(locations);

    window.SipSober?.sendVenuesToNative?.();

    setTimeout(() => {
      map.invalidateSize(true);
    }, 200);
  
    /* =========================
   Bottom Tab Bar Logic
   ========================= */
(() => {
  const nav = document.getElementById('bottom-nav');
  if (!nav) return;

  const btns = nav.querySelectorAll('.tab-btn');
  btns.forEach(btn => {
    btn.addEventListener('click', () => {
      btns.forEach(b => b.classList.remove('is-active'));
      btn.classList.add('is-active');
    });
  });
})();

// ================================
// Swift ‚Üí JS sync (keep stars filled)
// ================================
window.SipSober = window.SipSober || {};

window.SipSober.setFavorites = function (payload) {
  const ids = new Set((payload && payload.ids) || []);

  document.querySelectorAll(".fav-btn[data-id]").forEach(btn => {
    const id = btn.dataset.id;
    btn.classList.toggle("is-fav", ids.has(id));
  });
};

// ================================
// Swift ‚Üí JS: set filters (brands + neighborhoods)
// ================================
window.SipSober.setFilters = function (payload) {
  const brands = Array.isArray(payload?.brands) ? payload.brands : [];
  const neighborhoods = Array.isArray(payload?.neighborhoods) ? payload.neighborhoods : [];

  // Brand checkboxes
  document.querySelectorAll('input[id^="brand-"]').forEach(cb => {
    cb.checked = brands.includes(cb.value);
  });

  // Neighborhood checkboxes
  document.querySelectorAll('input[id^="n-"]').forEach(cb => {
    cb.checked = neighborhoods.includes(cb.value);
  });

  // Apply using your unified logic (keeps Near Me consistent)
  applyFiltersWithNearMe();
};

// ================================
// Swift ‚Üí JS: focus a venue (zoom + open popup)
// ================================
let _lastFocusedVenueId = null;

window.SipSober.focusVenue = function (payload) {
  const venueId =
    (typeof payload === "string" ? payload : payload?.venueId) || "";

  const id = String(venueId).trim();
  if (!id) return;

  // ‚úÖ PREVENT "CLOSE X" BUG: if we already focused this same venue, ignore repeats
  if (_lastFocusedVenueId === id) return;
  _lastFocusedVenueId = id;

  if (!_nearMeActive) {
  resetForFocusOnly();
  }

  let tries = 0;

  (function attempt() {
    const marker = markersById?.[id];

    if (!marker) {
      tries += 1;
      if (tries <= 25) {
        setTimeout(attempt, 120);
        return;
      }
      console.warn("‚ùå focusVenue: marker not found after retries for id:", id);
      _lastFocusedVenueId = null; // allow retry later
      return;
    }

    const ll = marker.getLatLng();
    map.invalidateSize(true);
    map.setView([ll.lat, ll.lng], 16, { animate: true });

    setTimeout(() => {
      setActiveMarker(marker);
      marker.openPopup();

      // If Leaflet doesn't fire popupclose for some reason, also unlock when X is tapped
      const closer = document.querySelector(".leaflet-popup-close-button");
      if (closer) {
        closer.addEventListener(
          "click",
          () => {
            _lastFocusedVenueId = null;
          },
          { once: true }
        );
      }
    }, 200);

    const panel = document.getElementById("bottom-panel");
    if (panel) panel.classList.add("expanded");
  })();
};

// ‚úÖ Alias so Swift can call focusVenueById(id)
window.SipSober.focusVenueById = function (id) {
  window.SipSober.focusVenue(id);
};

  </script>

  <!-- ===== Sip Sober: one-time onboarding banner JS ===== -->
  <script>
(function () {
  const KEY = "ss_seen_map_onboarding_v1";

  function showOnboarding() {
    if (localStorage.getItem(KEY) === "true") return;

    const el = document.getElementById("ss-onboard");
    if (!el) return;

    el.hidden = false;
    requestAnimationFrame(() => el.classList.add("is-visible"));

    const okBtn = document.getElementById("ss-onboard-ok");

    function dismiss() {
      localStorage.setItem(KEY, "true");
      el.classList.remove("is-visible");
      setTimeout(() => (el.hidden = true), 240);
    }

    okBtn?.addEventListener("click", dismiss);
  }

  window.addEventListener("load", () => {
    setTimeout(showOnboarding, 450);
  });
})();
</script>
</body>
</html>
